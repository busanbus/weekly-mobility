<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>모빌리티 주간동향 - 웹 입력폼 (GAS POST, 시트 컬럼 매칭)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans KR', system-ui, -apple-system, Arial, sans-serif; }
  </style>
  <meta name="color-scheme" content="light dark">
  <link rel="icon" href="data:,">
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="min-h-dvh">
    <header class="border-b border-slate-200 bg-white/70 backdrop-blur sticky top-0 z-10">
      <div class="max-w-5xl mx-auto px-4 py-4">
        <h1 class="text-xl sm:text-2xl font-semibold">모빌리티 주간동향 - 웹 입력폼</h1>
        <p class="text-slate-500 text-sm mt-1">구글 스프레드시트와 연동하여 뉴스 항목을 등록합니다.</p>
      </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-6 pb-24">
      <section class="bg-white shadow-sm rounded-xl border border-slate-200 p-5 sm:p-6 mb-6">
        <h2 class="text-lg font-medium mb-5 text-slate-800">연결 및 메타 정보</h2>

        <!-- GAS 웹앱 URL -->
        <div class="mb-5">
          <label class="block text-sm font-medium text-slate-700 mb-2">GAS WebApp URL</label>
          <input id="url" class="w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition" placeholder="https://script.google.com/macros/s/.../exec">
        </div>

        <!-- 날짜 정보 그룹 -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-5">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">년도</label>
            <input id="year" type="number" class="w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition" placeholder="예: 2025">
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">월</label>
            <input id="month" type="number" class="w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition" placeholder="예: 12">
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">주차</label>
            <input id="week" type="number" class="w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition" placeholder="예: 12">
          </div>
        </div>

        <!-- PDF URL -->
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">PDF URL</label>
          <input id="pdf" type="url" class="w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition" placeholder="https://drive.google.com/file/.../view?usp=sharing">
        </div>
      </section>

      <!-- 항목(제목/카테고리/요약/이미지/링크 × N) -->
      <section>
        <h2 class="text-lg font-medium mb-4 text-slate-800">뉴스 항목</h2>
        <div id="items" class="space-y-4"></div>
      </section>
    </main>

    <!-- 플로팅 버튼 그룹 -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col sm:flex-row gap-3">
      <button id="add" class="inline-flex items-center justify-center gap-2 rounded-lg border border-slate-300 bg-white shadow-lg hover:shadow-xl px-4 py-3 text-sm font-medium text-slate-700 hover:bg-slate-50 active:bg-slate-100 transition-all duration-200">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        항목 추가
      </button>
      <button id="send" class="inline-flex items-center justify-center gap-2 rounded-lg bg-sky-600 text-white shadow-lg hover:shadow-xl px-5 py-3 text-sm font-medium hover:bg-sky-700 active:bg-sky-800 transition-all duration-200">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        전송
      </button>
    </div>
  </div>

  <script>
    const itemsEl = document.getElementById('items');

    // 항목 블럭 템플릿
    function addItem() {
      const i = itemsEl.children.length + 1;
      const el = document.createElement('div');
      el.className = 'item rounded-xl border border-slate-200 bg-white shadow-sm p-4 sm:p-5';
      el.innerHTML = `
        <div class="grid grid-cols-12 gap-3 items-start mb-2">
          <label class="col-span-12 sm:col-span-3 pt-1.5 text-sm font-medium text-slate-700">제목 ${i}</label>
          <input class="col-span-12 sm:col-span-9 rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" data-k="title" />
        </div>
        <div class="grid grid-cols-12 gap-3 items-start mb-2">
          <label class="col-span-12 sm:col-span-3 pt-1.5 text-sm font-medium text-slate-700">카테고리 ${i}</label>
          <input class="col-span-12 sm:col-span-9 rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" data-k="category" />
        </div>
        <div class="grid grid-cols-12 gap-3 items-start mb-2">
          <label class="col-span-12 sm:col-span-3 pt-1.5 text-sm font-medium text-slate-700">요약 ${i}</label>
          <textarea class="col-span-12 sm:col-span-9 rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" rows="3" data-k="summary"></textarea>
        </div>
        <div class="grid grid-cols-12 gap-3 items-start mb-2">
          <label class="col-span-12 sm:col-span-3 pt-1.5 text-sm font-medium text-slate-700">이미지 ${i}</label>
          <input class="col-span-12 sm:col-span-9 rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" placeholder="https://..." data-k="image" />
        </div>
        <div class="grid grid-cols-12 gap-3 items-start">
          <label class="col-span-12 sm:col-span-3 pt-1.5 text-sm font-medium text-slate-700">링크 ${i}</label>
          <input class="col-span-12 sm:col-span-9 rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" placeholder="https://..." data-k="link" />
        </div>
      `;
      itemsEl.appendChild(el);
    }

    // 기본 6개 항목
    document.getElementById('add').onclick = addItem;
    for (let i=0; i<6; i++) addItem();

    // 폼 → payload (시트 컬럼과 1:1 매칭)
    function buildPayload() {
      const items = Array.from(itemsEl.children).map((div) => {
        const pick = (k) => (div.querySelector(`[data-k="${k}"]`)?.value || '').trim();
        return {
          title: pick('title'),       // 제목N
          category: pick('category'), // 카테고리N
          summary: pick('summary'),   // 요약N
          image: pick('image'),       // 이미지N
          link: pick('link')          // 링크N
        };
      }).filter(it => Object.values(it).some(Boolean));

      return {
        year: parseInt(document.getElementById('year').value, 10),   // '년도'
        month: parseInt(document.getElementById('month').value, 10), // '월'
        week: parseInt(document.getElementById('week').value, 10),   // '주차'
        pdf_url: document.getElementById('pdf').value.trim(),        // 'PDF URL'
        items                                                             // 제목/카테고리/요약/이미지/링크
      };
    }

    // 제출(POST) → GAS (프리플라이트 없이 전송)
    document.getElementById('send').onclick = async () => {
      const url = document.getElementById('url').value.trim();
      if (!url) return alert('GAS WebApp URL을 입력하세요.');
      const payload = buildPayload();

      try {
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
          body: new URLSearchParams({ payload: JSON.stringify(payload) })
        });

        const txt = await res.text();
        try {
          const json = JSON.parse(txt);
          alert(json.success ? (json.message || '전송 성공') : ('전송 실패: ' + (json.error || '알 수 없는 오류')));
        } catch (_) {
          alert('응답: ' + txt);
        }
      } catch (e) {
        alert('전송 실패: ' + e.message);
      }
    };
  </script>
</body>
</html>
