<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>모빌리티 주간동향 - 웹 입력폼 (GAS POST)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Inter', 'Noto Sans KR', system-ui, -apple-system, Arial, sans-serif; 
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    .float-animation {
      animation: float 6s ease-in-out infinite;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #E71666 0%, #1F83C5 50%, #E71666 100%);
      background-size: 200% 200%;
      animation: gradient-shift 15s ease infinite;
    }
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .input-focus:focus {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(31, 131, 197, 0.3);
    }
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .btn-primary {
      background: #1F83C5;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .btn-primary:hover {
      background: #1a6ba3;
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(31, 131, 197, 0.4);
    }
    .btn-secondary {
      background: #E71666;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .btn-secondary:hover {
      background: #c91459;
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(231, 22, 102, 0.4);
    }
    .input-field {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .input-field:focus {
      border-color: #1F83C5;
      box-shadow: 0 0 0 3px rgba(31, 131, 197, 0.1);
    }
    /* 플로팅 버튼 공통 그림자/호버 부드러움 */
    .btn-fab {
      box-shadow: 0 10px 24px rgba(0,0,0,.12);
      transition: background-color .2s ease, box-shadow .2s ease, transform .2s ease;
    }
    .btn-fab:hover {
      box-shadow: 0 14px 28px rgba(0,0,0,.18);
      transform: translateY(-1px);
    }
  </style>
  <meta name="color-scheme" content="light dark">
  <link rel="icon" href="data:,">
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-pink-50 text-slate-900 min-h-screen" style="--tw-gradient-from: rgba(231, 22, 102, 0.05); --tw-gradient-to: rgba(31, 131, 197, 0.05);">
  <div class="min-h-dvh">
    <header class="glass-effect shadow-sm" style="border-bottom: 1px solid rgba(31, 131, 197, 0.2);">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold bg-clip-text text-transparent" style="background-image: linear-gradient(to right, #1F83C5, #E71666);">
              모빌리티 주간동향
            </h1>
            <p class="text-slate-600 text-sm sm:text-base mt-2 font-medium">웹 입력폼 - DB연동 및 HTML파일 생성</p>
          </div>
          <div class="flex items-center gap-2 text-xs sm:text-sm text-slate-500">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>실시간 동기화</span>
          </div>
        </div>
      </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-32">
      <section class="glass-effect rounded-2xl shadow-xl p-6 sm:p-8 mb-8 card-hover" style="border: 1px solid rgba(31, 131, 197, 0.2);">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-1 h-8 rounded-full" style="background: #E71666;"></div>
          <h2 class="text-xl sm:text-2xl font-bold text-slate-800">연결 및 메타 정보</h2>
        </div>

        <!-- GAS 웹앱 URL -->
        <div class="mb-6">
          <label class="block text-base font-semibold text-slate-700 mb-3 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
            </svg>
            GAS WebApp URL
          </label>
          <input id="url" class="input-field w-full rounded-xl border-2 border-slate-200 bg-white px-5 py-4 text-base focus:outline-none transition-all" style="--tw-ring-color: #1F83C5;" onfocus="this.style.boxShadow='0 0 0 3px rgba(31, 131, 197, 0.1)'; this.style.borderColor='#1F83C5';" onblur="this.style.boxShadow=''; this.style.borderColor='rgb(226 232 240)';" placeholder="https://script.google.com/macros/s/.../exec">
        </div>

        <!-- 날짜 정보 그룹 -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-5 mb-6">
          <div>
            <label class="block text-base font-semibold text-slate-700 mb-3 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              년도
            </label>
            <input id="year" type="number" class="input-field w-full rounded-xl border-2 border-slate-200 bg-white px-5 py-4 text-base focus:outline-none transition-all" style="--tw-ring-color: #1F83C5;" onfocus="this.style.boxShadow='0 0 0 3px rgba(31, 131, 197, 0.1)'; this.style.borderColor='#1F83C5';" onblur="this.style.boxShadow=''; this.style.borderColor='rgb(226 232 240)';" placeholder="예: 2025">
          </div>
          <div>
            <label class="block text-base font-semibold text-slate-700 mb-3 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              월
            </label>
            <input id="month" type="number" class="input-field w-full rounded-xl border-2 border-slate-200 bg-white px-5 py-4 text-base focus:outline-none transition-all" style="--tw-ring-color: #1F83C5;" onfocus="this.style.boxShadow='0 0 0 3px rgba(31, 131, 197, 0.1)'; this.style.borderColor='#1F83C5';" onblur="this.style.boxShadow=''; this.style.borderColor='rgb(226 232 240)';" placeholder="예: 12">
          </div>
          <div>
            <label class="block text-base font-semibold text-slate-700 mb-3 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              주차
            </label>
            <input id="week" type="number" class="input-field w-full rounded-xl border-2 border-slate-200 bg-white px-5 py-4 text-base focus:outline-none transition-all" style="--tw-ring-color: #1F83C5;" onfocus="this.style.boxShadow='0 0 0 3px rgba(31, 131, 197, 0.1)'; this.style.borderColor='#1F83C5';" onblur="this.style.boxShadow=''; this.style.borderColor='rgb(226 232 240)';" placeholder="예: 12">
          </div>
        </div>

        <!-- PDF URL -->
        <div>
          <label class="block text-base font-semibold text-slate-700 mb-3 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
            </svg>
            PDF URL
          </label>
          <input id="pdf" type="url" class="input-field w-full rounded-xl border-2 border-slate-200 bg-white px-5 py-4 text-base focus:outline-none transition-all" style="--tw-ring-color: #1F83C5;" onfocus="this.style.boxShadow='0 0 0 3px rgba(31, 131, 197, 0.1)'; this.style.borderColor='#1F83C5';" onblur="this.style.boxShadow=''; this.style.borderColor='rgb(226 232 240)';" placeholder="https://drive.google.com/file/.../view?usp=sharing">
        </div>
      </section>

      <!-- 항목(제목/카테고리/요약/이미지/링크 × N) -->
      <section>
        <div class="flex items-center gap-3 mb-6">
          <div class="w-1 h-8 rounded-full" style="background: #E71666;"></div>
          <h2 class="text-xl sm:text-2xl font-bold text-slate-800">뉴스 항목</h2>
        </div>
        <div id="items" class="space-y-6"></div>
      </section>
    </main>

    <!-- 플로팅 버튼 그룹 -->
    <div class="fixed bottom-4 sm:bottom-6 right-8 sm:right-10 z-50 flex flex-col gap-3 sm:gap-4">
      <button id="top" class="btn-fab inline-flex items-center justify-start text-left gap-2 sm:gap-3 rounded-xl text-white shadow-2xl px-6 sm:px-8 py-3.5 sm:py-4 text-sm sm:text-base font-semibold active:scale-95 w-full sm:w-auto min-w-[120px] sm:min-w-[140px] transition-all duration-200" style="background:#1480C3;" onmouseover="this.style.background='#116AA1';" onmouseout="this.style.background='#1480C3';">
        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
        <span class="hidden sm:inline">맨위로</span>
        <span class="sm:hidden">TOP</span>
      </button>
      <button id="add" class="btn-fab btn-secondary inline-flex items-center justify-start text-left gap-2 sm:gap-3 rounded-xl text-white shadow-2xl px-6 sm:px-8 py-3.5 sm:py-4 text-sm sm:text-base font-semibold active:scale-95 w-full sm:w-auto min-w-[120px] sm:min-w-[140px]" style="background:#E00C5E;" onmouseover="this.style.background='#A5124C';" onmouseout="this.style.background='#E00C5E';">
        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"></path>
        </svg>
        <span class="hidden sm:inline">항목 추가</span>
        <span class="sm:hidden">추가</span>
      </button>
      <button id="gen-all" class="btn-fab inline-flex items-center justify-start text-left gap-2 sm:gap-3 rounded-xl text-white shadow-2xl px-6 sm:px-8 py-3.5 sm:py-4 text-sm sm:text-base font-semibold active:scale-95 w-full sm:w-auto min-w-[120px] sm:min-w-[140px]" style="background:#1480C3" onmouseover="this.style.background='#116AA1';" onmouseout="this.style.background='#1480C3';">
        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="9"></circle>
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 12h18M12 3a15 15 0 010 18M12 3a15 15 0 000 18"></path>
        </svg>
        <span>번역본 다운로드</span>
      </button>
      <button id="send" class="btn-fab btn-primary inline-flex items-center justify-start text-left gap-2 sm:gap-3 rounded-xl text-white shadow-2xl px-6 sm:px-8 py-3.5 sm:py-4 text-sm sm:text-base font-semibold active:scale-95 w-full sm:w-auto min-w-[120px] sm:min-w-[140px]" style="background:#E00C5E;" onmouseover="this.style.background='#A5124C';" onmouseout="this.style.background='#E00C5E';">
        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
        </svg>
        <span>DB에 뉴스생성</span>
      </button>
    </div>

    <!-- 언어별 HTML 생성 버튼들 -->
    <div class="fixed bottom-4 sm:bottom-6 left-4 sm:left-6 z-50 max-w-[182px] sm:max-w-none">
      <div class="bg-white/95 backdrop-blur-lg rounded-xl shadow-2xl p-4 sm:p-5" style="border: 1px solid rgba(31, 131, 197, 0.2);">
        <div class="text-sm font-semibold text-slate-600 mb-3 sm:mb-4 px-3 hidden sm:block">HTML 생성</div>
        <div class="text-xs font-semibold text-slate-600 mb-3 px-3 sm:hidden">HTML</div>
        <div class="grid grid-cols-2 gap-3">
          <button id="gen-ko" class="inline-flex items-center justify-center rounded-lg bg-gradient-to-r from-emerald-500 to-teal-600 text-white px-3 sm:px-5 py-2.5 sm:py-4 text-xs sm:text-base font-semibold shadow-lg hover:shadow-xl transition-all hover:scale-105 active:scale-95">
            <span class="hidden sm:inline">한국어</span>
            <span class="sm:hidden">KO</span>
          </button>
          <button id="gen-en" class="inline-flex items-center justify-center rounded-lg bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-3 sm:px-5 py-2.5 sm:py-4 text-xs sm:text-base font-semibold shadow-lg hover:shadow-xl transition-all hover:scale-105 active:scale-95">
            <span class="hidden sm:inline">English</span>
            <span class="sm:hidden">EN</span>
          </button>
          <button id="gen-jp" class="inline-flex items-center justify-center rounded-lg bg-gradient-to-r from-amber-500 to-orange-600 text-white px-3 sm:px-5 py-2.5 sm:py-4 text-xs sm:text-base font-semibold shadow-lg hover:shadow-xl transition-all hover:scale-105 active:scale-95">
            <span class="hidden sm:inline">日本語</span>
            <span class="sm:hidden">JP</span>
          </button>
          <button id="gen-cn" class="inline-flex items-center justify-center rounded-lg bg-gradient-to-r from-rose-500 to-pink-600 text-white px-3 sm:px-5 py-2.5 sm:py-4 text-xs sm:text-base font-semibold shadow-lg hover:shadow-xl transition-all hover:scale-105 active:scale-95">
            <span class="hidden sm:inline">中文</span>
            <span class="sm:hidden">CN</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 전역 변수
    let itemsEl;

    // DOM이 완전히 로드된 후 실행
    function initForm() {
      itemsEl = document.getElementById('items');
      if (!itemsEl) {
        console.error('items element not found');
        return;
      }

      // 항목 블럭 템플릿
      function addItem() {
        if (itemsEl.children.length >= 15) {
          alert('뉴스 항목은 최대 15개까지 추가할 수 있습니다.');
          return;
        }
        const i = itemsEl.children.length + 1;
      const el = document.createElement('div');
      el.className = 'item glass-effect rounded-2xl border-2 shadow-xl p-6 sm:p-8 card-hover';
      el.style.borderColor = 'rgba(31, 131, 197, 0.2)';
      el.innerHTML = `
        <div class="flex items-center gap-3 mb-6 pb-4" style="border-bottom: 1px solid rgba(31, 131, 197, 0.2);">
          <div class="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg" style="background: #E71666;">
            ${i}
          </div>
          <h3 class="text-lg font-bold text-slate-800">뉴스 항목 ${i}</h3>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-5 mb-5">
          <label class="lg:col-span-2 text-base font-semibold text-slate-700 flex items-center gap-2 lg:pt-3">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
            </svg>
            제목
          </label>
          <input class="lg:col-span-10 input-field rounded-xl border-2 border-slate-200 bg-white px-5 py-3.5 text-base focus:outline-none transition-all" onfocus="this.style.boxShadow='0 0 0 3px rgba(31, 131, 197, 0.1)'; this.style.borderColor='#1F83C5';" onblur="this.style.boxShadow=''; this.style.borderColor='rgb(226 232 240)';" placeholder="뉴스 제목을 입력하세요" data-k="title" />
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-5 mb-5">
          <label class="lg:col-span-2 text-base font-semibold text-slate-700 flex items-center gap-2 lg:pt-3">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
            </svg>
            카테고리
          </label>
          <input class="lg:col-span-10 input-field rounded-xl border-2 border-slate-200 bg-white px-5 py-3.5 text-base focus:outline-none transition-all" onfocus="this.style.boxShadow='0 0 0 3px rgba(31, 131, 197, 0.1)'; this.style.borderColor='#1F83C5';" onblur="this.style.boxShadow=''; this.style.borderColor='rgb(226 232 240)';" placeholder="예: 국토부, 부산, 서울 등" data-k="category" />
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-5 mb-5">
          <label class="lg:col-span-2 text-base font-semibold text-slate-700 flex items-center gap-2 lg:pt-3">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            요약
          </label>
          <textarea class="lg:col-span-10 input-field rounded-xl border-2 border-slate-200 bg-white px-5 py-3.5 text-base focus:outline-none transition-all resize-y" rows="4" onfocus="this.style.boxShadow='0 0 0 3px rgba(31, 131, 197, 0.1)'; this.style.borderColor='#1F83C5';" onblur="this.style.boxShadow=''; this.style.borderColor='rgb(226 232 240)';" placeholder="뉴스 요약 내용을 입력하세요" data-k="summary"></textarea>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-5 mb-5">
          <label class="lg:col-span-2 text-base font-semibold text-slate-700 flex items-center gap-2 lg:pt-3">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            이미지
          </label>
          <input class="lg:col-span-10 input-field rounded-xl border-2 border-slate-200 bg-white px-5 py-3.5 text-base focus:outline-none transition-all" onfocus="this.style.boxShadow='0 0 0 3px rgba(31, 131, 197, 0.1)'; this.style.borderColor='#1F83C5';" onblur="this.style.boxShadow=''; this.style.borderColor='rgb(226 232 240)';" placeholder="https://..." data-k="image" />
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-5">
          <label class="lg:col-span-2 text-base font-semibold text-slate-700 flex items-center gap-2 lg:pt-3">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #1F83C5;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
            </svg>
            링크
          </label>
          <input class="lg:col-span-10 input-field rounded-xl border-2 border-slate-200 bg-white px-5 py-3.5 text-base focus:outline-none transition-all" onfocus="this.style.boxShadow='0 0 0 3px rgba(31, 131, 197, 0.1)'; this.style.borderColor='#1F83C5';" onblur="this.style.boxShadow=''; this.style.borderColor='rgb(226 232 240)';" placeholder="https://..." data-k="link" />
        </div>
      `;
        itemsEl.appendChild(el);
      }

      // 기본 6개 항목
      const topButton = document.getElementById('top');
      const addButton = document.getElementById('add');
      const sendButton = document.getElementById('send');
      
      // 맨위로 버튼
      if (topButton) {
        topButton.onclick = () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };
      }
      
      if (addButton) {
        addButton.onclick = addItem;
      }
      
      for (let i=0; i<6; i++) addItem();

      // 제출(POST) → GAS (프리플라이트 없이 전송)
      if (sendButton) {
        sendButton.onclick = async () => {
          const url = document.getElementById('url').value.trim();
          if (!url) return alert('GAS WebApp URL을 입력하세요.');
          const payload = buildPayload();

          try {
            const res = await fetch(url, {
              method: 'POST',
              headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
              body: new URLSearchParams({ payload: JSON.stringify(payload) })
            });

            const txt = await res.text();
            try {
              const json = JSON.parse(txt);
              alert(json.success ? (json.message || '전송 성공') : ('전송 실패: ' + (json.error || '알 수 없는 오류')));
            } catch (_) {
              alert('응답: ' + txt);
            }
          } catch (e) {
            alert('전송 실패: ' + e.message);
          }
        };
      }

      // HTML 생성 버튼 이벤트 리스너
      const genKo = document.getElementById('gen-ko');
      const genEn = document.getElementById('gen-en');
      const genJp = document.getElementById('gen-jp');
      const genCn = document.getElementById('gen-cn');
      
      if (genKo) genKo.onclick = () => downloadHtml('ko');
      if (genEn) genEn.onclick = () => downloadHtml('en');
      if (genJp) genJp.onclick = () => downloadHtml('jp');
      if (genCn) genCn.onclick = () => downloadHtml('cn');
    }

    // 폼 → payload (시트 컬럼과 1:1 매칭) - 전역 함수로 이동
    function buildPayload() {
      if (!itemsEl) return null;
      const items = Array.from(itemsEl.children).map((div) => {
        const pick = (k) => (div.querySelector(`[data-k="${k}"]`)?.value || '').trim();
        return {
          title: pick('title'),       // 제목N
          category: pick('category'), // 카테고리N
          summary: pick('summary'),   // 요약N
          image: pick('image'),       // 이미지N
          link: pick('link')          // 링크N
        };
      }).filter(it => Object.values(it).some(Boolean));

      return {
        year: parseInt(document.getElementById('year')?.value || 0, 10),   // '년도'
        month: parseInt(document.getElementById('month')?.value || 0, 10), // '월'
        week: parseInt(document.getElementById('week')?.value || 0, 10),   // '주차'
        pdf_url: (document.getElementById('pdf')?.value || '').trim(),        // 'PDF URL'
        items                                                             // 제목/카테고리/요약/이미지/링크
      };
    }

    // DOM이 완전히 로드된 후 실행
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initForm);
    } else {
      initForm();
    }

    // ------------------------------
    // 정적 HTML 생성 유틸리티
    // ------------------------------
    const tDict = {
      ko: {
        siteTitle: '모빌리티 주간동향',
        headerPublisher: '발행 : 전략기획팀',
        pdfTitle: '주간 동향 보고서 원문(PDF)보기',
        pdfDesc: '클릭하시면 최신 주간 동향 PDF 파일을 새 창에서 확인하실 수 있습니다.',
        seeMore: '자세히 보기',
        dateFmt: (y,m,w) => `${y}년 ${m}월 ${w}주차`,
        langCode: 'ko'
      },
      en: {
        siteTitle: 'Mobility Weekly',
        headerPublisher: 'Published by: Strategic Planning Team',
        pdfTitle: 'View Original Report (PDF)',
        pdfDesc: 'Click to view the latest weekly trends PDF file in a new window.',
        seeMore: 'Read More',
        dateFmt: (y,m,w) => `Week ${w}, ${new Date(`${y}-${String(m).padStart(2,'0')}-01`).toLocaleString('en',{month:'long'})} ${y}`,
        langCode: 'en'
      },
      jp: {
        siteTitle: 'モビリティ週間動向',
        headerPublisher: '発行：戦略企画チーム',
        pdfTitle: '週間動向レポート原文(PDF)を見る',
        pdfDesc: '最新の週間動向PDFファイルを新しいウィンドウで確認できます。',
        seeMore: '詳細を見る',
        dateFmt: (y,m,w) => `${y}年${m}月第${w}週`,
        langCode: 'jp'
      },
      cn: {
        siteTitle: '移动出行周报',
        headerPublisher: '发行：战略企划组',
        pdfTitle: '查看周报原文(PDF)',
        pdfDesc: '点击在新窗口中查看最新的周报PDF文件。',
        seeMore: '查看详情',
        dateFmt: (y,m,w) => `${y}年${m}月第${w}周`,
        langCode: 'cn'
      }
    };

    function escapeHtml(s){
      return String(s||'')
        .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;').replace(/'/g,'&#039;');
    }

    function renderItems(items, dict){
      return items.map(it => {
        const img = it.image ? `<img src="${escapeHtml(it.image)}" alt="${escapeHtml(it.title)}" loading="lazy">` : '';
        const link = it.link ? `<a href="${escapeHtml(it.link)}" class="news-link" target="_blank">${dict.seeMore}</a>` : '';
        return `
      <article class="news-card">
        <div class="news-image">${img}</div>
        <div class="news-content">
          <span class="news-category">${escapeHtml(it.category)}</span>
          <h2 class="news-title">${escapeHtml(it.title)}</h2>
          <p class="news-summary">${escapeHtml(it.summary)}</p>
          <div class="news-footer">${link}</div>
        </div>
      </article>`;
      }).join('\n');
    }

    function renderHtml(lang){
      const p = buildPayload();
      const dict = tDict[lang];
      const mm = String(p.month).padStart(2,'0');
      const dateText = dict.dateFmt(p.year, p.month, p.week);
      const itemsHtml = renderItems(p.items, dict);
      const langAttr = lang === 'ko' ? 'ko' : (lang === 'en' ? 'en' : (lang === 'jp' ? 'ja' : 'zh-CN'));
      const translateAttr = lang !== 'ko' ? ' translate="no"' : '';
      const metaTranslate = lang !== 'ko' ? '<meta name="google" content="notranslate">' : '';
      // CDN 경로 (week5.html 표준에 맞춤)
      const cdnBase = 'https://cdn.jsdelivr.net/gh/busanbus/weekly-mobility/';
      const ogUrlPath = lang === 'ko' ? '' : '/' + dict.langCode;
      const ogUrl = 'https://busanbus.github.io/weekly-mobility/archive/' + p.year + '/' + mm + ogUrlPath + '/week' + p.week + '.html';
      // 제목 생성 (week5.html 형식에 맞춤)
      const pageTitle = lang === 'ko' ? `모빌리티 주간 동향 ${p.month}월 ${p.week}주차` : dict.siteTitle;
      // index.html 상대 경로 계산 (archive/{year}/{month}/...)
      const relativeDepth = lang === 'ko' ? 3 : 4;
      const indexPath = '../'.repeat(relativeDepth) + 'index.html';
      
      const parts = [];
      parts.push('<!DOCTYPE html>');
      parts.push('<html lang="' + langAttr + '"' + translateAttr + '>');
      parts.push('<head>');
      parts.push('  <meta property="og:title" content="' + escapeHtml(dict.siteTitle) + '">');
      parts.push('  <meta property="og:type" content="website">');
      parts.push('  <meta property="og:image" content="https://i.ibb.co/MxP3nf65/og-image2.png">');
      parts.push('  <meta property="og:description" content="' + escapeHtml(dict.siteTitle) + '">');
      parts.push('  <meta property="og:site_name" content="' + escapeHtml(dict.siteTitle) + '">');
      parts.push('  <meta property="og:url" content="' + ogUrl + '">');
      if (metaTranslate) parts.push('  ' + metaTranslate);
      parts.push('  <meta charset="UTF-8">');
      parts.push('  <meta name="viewport" content="width=device-width,initial-scale=1.0">');
      parts.push('  <title>' + escapeHtml(pageTitle) + '</title>');
      // Google Analytics 추가 (week5.html 표준)
      parts.push('  <!-- Google tag (gtag.js) -->');
      parts.push('  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZXZ064TVJE"><\/script>');
      parts.push('  <script>');
      parts.push('    window.dataLayer = window.dataLayer || [];');
      parts.push('    function gtag(){dataLayer.push(arguments);}');
      parts.push('    gtag(\'js\', new Date());');
      parts.push('');
      parts.push('    gtag(\'config\', \'G-ZXZ064TVJE\');');
      parts.push('  <\/script>');
      parts.push('  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;family=Noto+Sans+KR:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">');
      parts.push('  <link rel="stylesheet" href="' + cdnBase + 'style/style.css">');
      parts.push('  <link rel="icon" type="image/png" href="https://www.busanbus.or.kr/assets/img/common/favicon.png">');
      parts.push('  <meta name="theme-color" content="#ffffff" />');
      parts.push('</head>');
      parts.push('<body' + translateAttr + '>');
      parts.push('  <script type="module" src="' + cdnBase + 'components/main-nav.js"><\/script>');
      parts.push('  <main-nav><\/main-nav>');
      parts.push('  <div class="container">');
      parts.push('    <header class="header">');
      parts.push('      <div class="header-content">');
      parts.push('        <!-- Mobile Header Bar -->');
      parts.push('        <div class="header-bar-mobile">');
      parts.push('          <img src="' + cdnBase + 'images/logo.svg" alt="조합 로고" class="header-logo in-bar" />');
      parts.push('          <span class="header-publisher in-bar">' + escapeHtml(dict.headerPublisher) + '<\/span>');
      parts.push('        <\/div>');
      parts.push('');
      parts.push('        <!-- Desktop Header Elements -->');
      parts.push('        <img src="' + cdnBase + 'images/logo.svg" alt="조합 로고" class="header-logo" />');
      parts.push('        <span class="header-publisher">' + escapeHtml(dict.headerPublisher) + '<\/span>');
      parts.push('');
      parts.push('        <!-- Date (logo.png 위로 이동) -->');
      parts.push('        <div class="header-date">');
      parts.push('          <span class="date-week-text">' + escapeHtml(dateText) + '<\/span>');
      parts.push('        <\/div>');
      parts.push('        <!-- Main Logo -->');
      parts.push('        <div class="logo-section">');
      parts.push('          <a href="' + indexPath + '" rel="noopener noreferrer">');
      parts.push('            <img src="' + cdnBase + 'images/logo.png" alt="' + escapeHtml(dict.siteTitle) + ' 로고" />');
      parts.push('          <\/a>');
      parts.push('        <\/div>');
      parts.push('      <\/div>');
      parts.push('    <\/header>');
      parts.push('');
      parts.push('    <!-- PDF Download Section -->');
      parts.push('    <div class="pdf-download">');
      parts.push('      <a href="' + escapeHtml(p.pdf_url) + '" target="_blank" class="pdf-box">');
      parts.push('        <div class="pdf-content-wrapper">');
      parts.push('          <img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" alt="PDF 아이콘" class="pdf-icon" />');
      parts.push('          <div>');
      parts.push('            <div class="pdf-title">' + escapeHtml(dict.pdfTitle) + '<\/div>');
      parts.push('          <\/div>');
      parts.push('        <\/div>');
      parts.push('        <div class="pdf-description">');
      parts.push('          ' + escapeHtml(dict.pdfDesc));
      parts.push('        <\/div>');
      parts.push('      <\/a>');
      parts.push('    <\/div>');
      parts.push('');
      parts.push('    <!-- News Grid -->');
      parts.push('    <div class="news-grid">');
      parts.push(itemsHtml);
      parts.push('    <\/div>');
      parts.push('');
      parts.push('    <mobility-footer lang="' + dict.langCode + '"><\/mobility-footer>');
      parts.push('  <\/div>');
      parts.push('');
      parts.push('  <!-- 플로팅UI(SNS) -->');
      parts.push('  <floating-sns><\/floating-sns>');
      parts.push('');
      parts.push('  <script type="module" src="' + cdnBase + 'components/floating-sns.js"><\/script>');
      parts.push('  <script type="module" src="' + cdnBase + 'components/footer.js"><\/script>');
      parts.push('<\/body>');
      parts.push('<\/html>');
      return parts.join('\n');
    }

    // 번역된 payload를 받아 정적 HTML을 생성
    function buildWeeklyHtml(payload, langKey){
      const dict = tDict[langKey];
      const mm = String(payload.month).padStart(2,'0');
      const dateText = dict.dateFmt(payload.year, payload.month, payload.week);
      const itemsHtml = renderItems(payload.items || [], dict);
      const langAttr = langKey === 'ko' ? 'ko' : (langKey === 'en' ? 'en' : (langKey === 'jp' ? 'ja' : 'zh-CN'));
      const translateAttr = langKey !== 'ko' ? ' translate="no"' : '';
      const metaTranslate = langKey !== 'ko' ? '<meta name="google" content="notranslate">' : '';
      const cdnBase = 'https://cdn.jsdelivr.net/gh/busanbus/weekly-mobility/';
      const ogUrlPath = langKey === 'ko' ? '' : '/' + dict.langCode;
      const ogUrl = 'https://busanbus.github.io/weekly-mobility/archive/' + payload.year + '/' + mm + ogUrlPath + '/week' + payload.week + '.html';
      const pageTitle = langKey === 'ko' ? `모빌리티 주간 동향 ${payload.month}월 ${payload.week}주차` : dict.siteTitle;
      const relativeDepth = langKey === 'ko' ? 3 : 4;
      const indexPath = '../'.repeat(relativeDepth) + 'index.html';

      const parts = [];
      parts.push('<!DOCTYPE html>');
      parts.push('<html lang="' + langAttr + '"' + translateAttr + '>');
      parts.push('<head>');
      parts.push('  <meta property="og:title" content="' + escapeHtml(dict.siteTitle) + '">');
      parts.push('  <meta property="og:type" content="website">');
      parts.push('  <meta property="og:image" content="https://i.ibb.co/MxP3nf65/og-image2.png">');
      parts.push('  <meta property="og:description" content="' + escapeHtml(dict.siteTitle) + '">');
      parts.push('  <meta property="og:site_name" content="' + escapeHtml(dict.siteTitle) + '">');
      parts.push('  <meta property="og:url" content="' + ogUrl + '">');
      if (metaTranslate) parts.push('  ' + metaTranslate);
      parts.push('  <meta charset="UTF-8">');
      parts.push('  <meta name="viewport" content="width=device-width,initial-scale=1.0">');
      parts.push('  <title>' + escapeHtml(pageTitle) + '</title>');
      parts.push('  <!-- Google tag (gtag.js) -->');
      parts.push('  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZXZ064TVJE"><\/script>');
      parts.push('  <script>');
      parts.push('    window.dataLayer = window.dataLayer || [];');
      parts.push('    function gtag(){dataLayer.push(arguments);}');
      parts.push('    gtag(\'js\', new Date());');
      parts.push('    gtag(\'config\', \'G-ZXZ064TVJE\');');
      parts.push('  <\/script>');
      parts.push('  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;family=Noto+Sans+KR:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">');
      parts.push('  <link rel="stylesheet" href="' + cdnBase + 'style/style.css">');
      parts.push('  <link rel="icon" type="image/png" href="https://www.busanbus.or.kr/assets/img/common/favicon.png">');
      parts.push('  <meta name="theme-color" content="#ffffff" />');
      parts.push('</head>');
      parts.push('<body' + translateAttr + '>');
      parts.push('  <script type="module" src="' + cdnBase + 'components/main-nav.js"><\/script>');
      parts.push('  <main-nav><\/main-nav>');
      parts.push('  <div class="container">');
      parts.push('    <header class="header">');
      parts.push('      <div class="header-content">');
      parts.push('        <div class="header-bar-mobile">');
      parts.push('          <img src="' + cdnBase + 'images/logo.svg" alt="조합 로고" class="header-logo in-bar" />');
      parts.push('          <span class="header-publisher in-bar">' + escapeHtml(dict.headerPublisher) + '<\/span>');
      parts.push('        <\/div>');
      parts.push('        <img src="' + cdnBase + 'images/logo.svg" alt="조합 로고" class="header-logo" />');
      parts.push('        <span class="header-publisher">' + escapeHtml(dict.headerPublisher) + '<\/span>');
      parts.push('        <div class="header-date"><span class="date-week-text">' + escapeHtml(dateText) + '<\/span></div>');
      parts.push('        <div class="logo-section"><a href="' + indexPath + '" rel="noopener noreferrer"><img src="' + cdnBase + 'images/logo.png" alt="' + escapeHtml(dict.siteTitle) + ' 로고" /><\/a></div>');
      parts.push('      <\/div>');
      parts.push('    <\/header>');
      parts.push('    <div class="pdf-download">');
      parts.push('      <a href="' + escapeHtml(payload.pdf_url) + '" target="_blank" class="pdf-box">');
      parts.push('        <div class="pdf-content-wrapper">');
      parts.push('          <img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" alt="PDF 아이콘" class="pdf-icon" />');
      parts.push('          <div><div class="pdf-title">' + escapeHtml(dict.pdfTitle) + '<\/div></div>');
      parts.push('        </div>');
      parts.push('        <div class="pdf-description">' + escapeHtml(dict.pdfDesc) + '<\/div>');
      parts.push('      <\/a>');
      parts.push('    <\/div>');
      parts.push('    <div class="news-grid">');
      parts.push(itemsHtml);
      parts.push('    <\/div>');
      parts.push('    <mobility-footer lang="' + dict.langCode + '"><\/mobility-footer>');
      parts.push('  <\/div>');
      parts.push('  <floating-sns><\/floating-sns>');
      parts.push('  <script type="module" src="' + cdnBase + 'components/floating-sns.js"><\/script>');
      parts.push('  <script type="module" src="' + cdnBase + 'components/footer.js"><\/script>');
      parts.push('<\/body>');
      parts.push('<\/html>');
      return parts.join('\n');
    }

    function downloadHtml(lang){
      const p = buildPayload();
      if (!p) {
        alert('폼 데이터를 불러올 수 없습니다.');
        return;
      }
      const mm = String(p.month).padStart(2,'0');
      const sub = lang==='ko' ? '' : `-${lang}`; // 파일명 구분만 위해 접미사 사용
      const filename = `week${p.week}${sub}.html`;
      const html = renderHtml(lang);
      const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => { URL.revokeObjectURL(a.href); a.remove(); }, 0);
    }

    // ==============================
    // 모든 언어 일괄 생성 (DeepL Worker)
    // ==============================
    const WORKER_URL = 'https://deepl.haman97.workers.dev'; // 배포한 Cloudflare Worker URL로 유지/교체

    async function generateAllLanguages() {
      const payload = buildPayload();
      if (!payload || !payload.items || payload.items.length === 0) {
        alert('뉴스 항목이 비어있습니다.');
        return;
      }
      try {
        const res = await fetch(WORKER_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ payload })
        });
        const { success, data, error } = await res.json();
        if (!success) {
          alert('번역 실패: ' + (error || 'unknown'));
          return;
        }
        const week = String(payload.week || '1').trim();
        const targets = [
          { k: 'ko', name: `week${week}.html` },
          { k: 'en', name: `week${week}-en.html` },
          { k: 'cn', name: `week${week}-cn.html` },
          { k: 'jp', name: `week${week}-jp.html` }
        ];
        for (const t of targets) {
          const pageHtml = buildWeeklyHtml(data[t.k], t.k);
          const blob = new Blob([pageHtml], { type: 'text/html;charset=utf-8' });
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = t.name;
          document.body.appendChild(a);
          a.click();
          setTimeout(() => { URL.revokeObjectURL(a.href); a.remove(); }, 0);
        }
        alert('한국어/영어/중국어/일본어 HTML 생성 완료!');
      } catch (e) {
        alert('요청 실패: ' + e.message);
      }
    }

    // 버튼 연결
    (function(){
      const btn = document.getElementById('gen-all');
      if (btn) btn.onclick = generateAllLanguages;
    })();
  </script>
</body>
</html>
